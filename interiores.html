<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Convenio Interiores ¬∑ ATRM - Tu Sindicato</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#FF6B35">
  <style>
    :root{ --primary:#FF6B35; --secondary:#FF8C42; --accent:#FFA726; --dark:#2C3E50; --light:#FFFFFF; }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;color:var(--dark);background:linear-gradient(180deg, #fff 0%, #fff7f0 100%)}
    /* Nav styles loaded from css/nav.css */

    .hero{max-width:1100px;margin:28px auto;padding:24px 20px;display:grid;grid-template-columns:1.1fr .9fr;gap:28px}
    .card{background:#fff;border:1px solid #ffe2cf;border-radius:18px;box-shadow:0 10px 24px rgba(255,119,51,.08)}
    .hero .left{padding:28px}
    .badge{display:inline-block;background:linear-gradient(90deg,var(--secondary),var(--accent));color:#4e2b00;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700}
    h1{margin:10px 0 14px;font-size:36px}
    .cta{display:flex;gap:12px;margin-top:18px;flex-wrap:wrap}
    .btn{background:linear-gradient(90deg,var(--primary),var(--secondary));border:none;color:#fff;padding:12px 16px;border-radius:12px;cursor:pointer;font-weight:700;text-decoration:none;display:inline-block;transition:.2s}
    .btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(255,107,53,.3)}
    .btn.alt{background:#fff;color:var(--primary);border:2px solid var(--primary)}
    .news{padding:18px}
    .grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:18px;padding:0 20px 40px}

    /* Chat flotante */
    #chat-atm-btn{position:fixed;bottom:20px;right:20px;width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,#27ae60,#2ecc71);color:#fff;border:none;font-size:28px;cursor:pointer;box-shadow:0 4px 12px rgba(39,174,96,.4);z-index:1000}
    #chat-atm-btn:hover{transform:scale(1.05)}
    #chat-atm-window{display:none;position:fixed;bottom:90px;right:20px;width:360px;max-width:90vw;height:500px;max-height:70vh;background:#fff;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.15);flex-direction:column;z-index:1001}
    #chat-header{background:linear-gradient(90deg,#27ae60,#2ecc71);color:#fff;padding:14px;border-radius:16px 16px 0 0;display:flex;justify-content:space-between;align-items:center}
    #chat-close{background:none;border:none;color:#fff;font-size:24px;cursor:pointer}
    #chat-messages{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:10px}
    #chat-form{display:flex;padding:10px;border-top:1px solid #eee}
    #chat-input{flex:1;padding:10px;border:1px solid #ddd;border-radius:20px;margin-right:8px}
    #chat-send{background:#27ae60;color:#fff;border:none;padding:10px 16px;border-radius:20px;cursor:pointer}

    @media(max-width:900px){.hero{grid-template-columns:1fr}.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <link rel="stylesheet" href="css/nav.css">
  <header class="premium-header">
    <div class="header-content">
      <a href="index.html" class="logo">üî• ATRM ¬∑ Tu Sindicato</a>
      <button class="menu-toggle" onclick="document.querySelector('.menu').classList.toggle('open')" aria-label="Men√∫">‚ò∞</button>
      <nav class="menu">
        <a href="index.html">Inicio</a>
        <a href="index.html#convenio">Viaria</a>
        <a href="interiores.html" class="active">Interiores</a>
        <a href="salaries.html">Salarios</a>
        <a href="conceptos_2026.html">Conceptos 2026</a>
        <a href="tramites.html">Tr√°mites</a>
        <a href="festivos.html">Festivos</a>
        <a href="generador.html">üìù Docs</a>
        <a href="podcasts.html">üéôÔ∏è Podcasts</a>
        <a href="index.html#contacto">Contacto</a>
      </nav>
    </div>
  </header>

  <main class="hero">
    <section class="left card">
      <span class="badge">Limpieza de Edificios y Locales ¬∑ Regi√≥n de Murcia</span>
      <h1>Convenio Colectivo de Limpieza de Interiores</h1>
      <p>Consulta aqu√≠ el convenio de limpieza de edificios y locales, descarga el PDF oficial y pregunta a la IA sobre tus derechos y condiciones laborales.</p>
      <div style="margin-top:20px">
        <p style="font-weight:600;margin-bottom:8px">üí¨ Asistente IA del convenio:</p>
        <input id="preguntaIAInline" placeholder="Escribe tu pregunta (ej: vacaciones, jornada, permisos...)" style="width:100%;padding:12px;border:1px solid #ffd2b5;border-radius:10px;font-size:15px;margin-bottom:10px" />
        <button class="btn" onclick="preguntarIAInline()">Preguntar</button>
      </div>
      <div id="vistaRespuesta" style="display:none;margin-top:16px;padding:16px;background:#fff7f0;border-radius:10px;border:1px solid #ffd2b5"></div>
      <div class="cta" style="margin-top:16px">
        <a class="btn" href="assets/convenio_interiores.pdf" download>üìÑ Descargar Convenio PDF</a>
      </div>
    </section>
    <aside class="card news">
      <h3>Datos clave del convenio</h3>
      <ul style="line-height:1.8">
        <li><strong>Jornada m√°xima:</strong> 1.792 horas/a√±o</li>
        <li><strong>Vacaciones:</strong> 30 d√≠as naturales</li>
        <li><strong>Pagas extra:</strong> 3 al a√±o (jun, dic, mar)</li>
        <li><strong>Descanso semanal:</strong> 1,5 d√≠as</li>
        <li><strong>Vigencia:</strong> BORM 20/09/2024</li>
      </ul>
    </aside>
  </main>

  <section class="grid">
    <div class="card" style="padding:20px">
      <h3>üìã Permisos retribuidos</h3>
      <p><strong>Matrimonio:</strong> 15 d√≠as<br>
      <strong>Nacimiento:</strong> 2 d√≠as<br>
      <strong>Fallecimiento:</strong> 2-4 d√≠as<br>
      <strong>Mudanza:</strong> 1 d√≠a<br>
      <strong>Ex√°menes:</strong> tiempo necesario</p>
    </div>
    <div class="card" style="padding:20px">
      <h3>üí∞ Salario y complementos</h3>
      <p>Salario base seg√∫n categor√≠a + trienios al 5%. Complemento de IT hasta 100% desde primer d√≠a en accidente laboral.</p>
    </div>
    <div class="card" style="padding:20px">
      <h3>üîÑ Subrogaci√≥n</h3>
      <p>En caso de cambio de empresa, se mantiene antig√ºedad, salario y condiciones. La nueva empresa debe respetar el convenio.</p>
    </div>
    <div class="card" style="padding:24px">
      <h3>üóìÔ∏è Calculadora de vacaciones y descansos</h3>
      <form id="formVacaciones" autocomplete="off" style="display:flex;flex-direction:column;gap:12px">
        <label><strong>Jornada anual (horas):</strong>
          <input type="number" id="jornadaInput" min="1000" max="2200" value="1792" required style="padding:8px;border-radius:8px;border:1px solid #ffd2b5;font-size:16px;width:100%">
        </label>
        <label><strong>D√≠as trabajados al a√±o:</strong>
          <input type="number" id="diasInput" min="1" max="365" value="225" required style="padding:8px;border-radius:8px;border:1px solid #ffd2b5;font-size:16px;width:100%">
        </label>
        <button type="submit" class="btn">Calcular</button>
      </form>
      <div id="resultadoVacaciones" style="margin-top:14px;font-size:16px;color:#1976D2"></div>
      <div style="font-size:13px;color:#2C3E50;margin-top:8px">Seg√∫n el convenio de limpieza de interiores de la Regi√≥n de Murcia: 30 d√≠as naturales de vacaciones y descansos proporcionales a la jornada.</div>
    </div>
  </section>

  <!-- Chat flotante IA Interiores -->
  <button id="chat-atm-btn" onclick="abrirChatInteriores()" aria-label="Abrir chat IA Interiores">üí¨</button>
  <div id="chat-atm-window">
    <div id="chat-header">
      <strong>ATRM Chat ¬∑ Interiores</strong>
      <select id="modoIAChat" style="padding:4px 8px;border-radius:8px;border:none;font-size:13px">
        <option value="breve">Breve</option>
        <option value="completo">Completo</option>
        <option value="estricto">Estricto</option>
      </select>
      <button id="chat-close" onclick="cerrarChatInteriores()">√ó</button>
    </div>
    <div id="chat-messages"></div>
    <form id="chat-form">
      <input id="chat-input" type="text" placeholder="Escribe tu pregunta..." autocomplete="off" />
      <button id="chat-send" type="submit">‚û§</button>
    </form>
  </div>

  <script src="js/ia_mejorada.js"></script>
  <script src="js/ia_interiores.js"></script>
  <script>
    // Convertir Markdown simple a HTML
    function limpiarMarkdown(texto) {
      if (!texto) return '';
      return texto
        .replace(/~~(.*?)~~/g, '<s>$1</s>')
        .replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>')
        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.+?)\*/g, '<em>$1</em>')
        .replace(/^### (.+)$/gm, '<h3>$1</h3>')
        .replace(/^## (.+)$/gm, '<h2>$1</h2>')
        .replace(/^# (.+)$/gm, '<h1>$1</h1>')
        .replace(/\n/g, '<br>');
    }

    function abrirChatInteriores(){
      document.getElementById('chat-atm-window').style.display = 'flex';
      setTimeout(()=>{
        const el = document.getElementById('chat-input');
        if(el) el.focus();
      }, 200);
      const sel = document.getElementById('modoIAChat');
      if (sel && window.iaInteriores){
        if (window.iaInteriores.modoEstrict) sel.value='estricto';
        else if (window.iaInteriores.modoBreve) sel.value='breve';
        else sel.value='completo';
      }
    }
    function cerrarChatInteriores(){
      document.getElementById('chat-atm-window').style.display = 'none';
    }

    function agregarMensajeChat(mensaje, remitente, guardar = true) {
      const chatMessages = document.getElementById('chat-messages');
      const msgDiv = document.createElement('div');
      msgDiv.style.maxWidth = '85%';
      msgDiv.style.alignSelf = remitente==='user'?'flex-end':'flex-start';
      msgDiv.style.background = remitente==='user'?'#e1ffc7':'#fff';
      msgDiv.style.color = '#222';
      msgDiv.style.padding = '8px 12px';
      msgDiv.style.borderRadius = remitente==='user'?'16px 16px 4px 16px':'16px 16px 16px 4px';
      msgDiv.style.boxShadow = '0 2px 8px rgba(0,0,0,0.04)';
      msgDiv.style.wordBreak = 'break-word';

      if (remitente === 'bot') {
        msgDiv.style.alignSelf = 'flex-start';
        msgDiv.innerHTML = limpiarMarkdown(mensaje);
      } else {
        msgDiv.style.alignSelf = 'flex-end';
        msgDiv.textContent = mensaje;
      }
      
      // A√±adir botones de feedback solo para mensajes del bot
      if (remitente === 'bot' && !mensaje.includes('‚úçÔ∏è Escribiendo')) {
        const feedbackDiv = document.createElement('div');
        feedbackDiv.style.marginTop = '6px';
        feedbackDiv.style.display = 'flex';
        feedbackDiv.style.gap = '8px';
        feedbackDiv.style.fontSize = '18px';
        
        const btnLike = document.createElement('button');
        btnLike.innerHTML = 'üëç';
        btnLike.style.border = 'none';
        btnLike.style.background = 'transparent';
        btnLike.style.cursor = 'pointer';
        btnLike.style.fontSize = '18px';
        btnLike.style.padding = '4px 8px';
        btnLike.style.opacity = '0.6';
        btnLike.onclick = () => registrarFeedback('like', feedbackDiv);
        
        const btnDislike = document.createElement('button');
        btnDislike.innerHTML = 'üëé';
        btnDislike.style.border = 'none';
        btnDislike.style.background = 'transparent';
        btnDislike.style.cursor = 'pointer';
        btnDislike.style.fontSize = '18px';
        btnDislike.style.padding = '4px 8px';
        btnDislike.style.opacity = '0.6';
        btnDislike.onclick = () => registrarFeedback('dislike', feedbackDiv);
        
        feedbackDiv.appendChild(btnLike);
        feedbackDiv.appendChild(btnDislike);
        msgDiv.appendChild(feedbackDiv);
      }
      
      chatMessages.appendChild(msgDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      if (guardar) {
        guardarHistorialChat();
      }
      return msgDiv;
    }
    
    function registrarFeedback(tipo, feedbackDiv) {
      feedbackDiv.innerHTML = '<span style="font-size:13px;color:#2C3E50;">‚úì Gracias por tu feedback</span>';
    }

    async function enviarPreguntaChat(pregunta) {
      if (!pregunta.trim()) return;

      agregarMensajeChat(pregunta, 'user');
      const thinkingMsg = agregarMensajeChat('‚úçÔ∏è Escribiendo...', 'bot', false);
      thinkingMsg.id = 'escribiendo-msg';

      try {
        const respuesta = await window.iaInteriores.generarRespuesta(pregunta);
        let textoRespuesta = 'ü§î No he encontrado una respuesta. Por favor, intenta con otra pregunta.';
        if (respuesta) {
          if (window.iaInteriores.modoRespuesta === 'breve') {
            textoRespuesta = respuesta.resumen || respuesta.detalle;
          } else {
            textoRespuesta = respuesta.detalle;
          }
        }
        thinkingMsg.innerHTML = limpiarMarkdown(textoRespuesta);
        thinkingMsg.id = '';
        guardarHistorialChat();
      } catch (e) {
        thinkingMsg.innerHTML = '‚ùå Error al obtener respuesta.';
        thinkingMsg.id = '';
        guardarHistorialChat();
      }
    }

    function guardarHistorialChat() {
      const chatMessages = document.getElementById('chat-messages');
      const historial = [];
      chatMessages.childNodes.forEach(msgDiv => {
        if (msgDiv.id === 'escribiendo-msg') return;
        historial.push({
          remitente: msgDiv.style.alignSelf === 'flex-end' ? 'user' : 'bot',
          mensaje: msgDiv.style.alignSelf === 'flex-end' ? msgDiv.textContent : msgDiv.innerHTML
        });
      });
      localStorage.setItem('historialChatInteriores', JSON.stringify(historial));
    }

    function cargarHistorialChat() {
      const historial = JSON.parse(localStorage.getItem('historialChatInteriores'));
      if (historial && historial.length) {
        historial.forEach(item => {
          agregarMensajeChat(item.mensaje, item.remitente, false);
        });
        return true;
      }
      return false;
    }

    document.getElementById('chat-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const input = document.getElementById('chat-input');
      const msg = input.value.trim();
      if(!msg) return;
      agregarMensajeChat(msg, 'user');
      input.value = '';
      agregarMensajeChat('...', 'bot');
      if (!window.iaInteriores) {
        enviarPreguntaChat(msg);
      } else {
        setTimeout(() => {
          const respuesta = window.iaInteriores.procesarMultiConsulta(msg);
          agregarMensajeChat(respuesta, 'bot');
        }, 500);
      }
    });
    
    document.getElementById('modoIAChat').addEventListener('change', (e)=>{
      if(window.iaInteriores) window.iaInteriores.setModoRespuesta(e.target.value);
    });

    // Sistema inline de respuestas (como en viaria)
    async function preguntarIAInline() {
      const input = document.getElementById('preguntaIAInline');
      const pregunta = input.value.trim();
      const vistaDiv = document.getElementById('vistaRespuesta');

      if (!pregunta) {
        vistaDiv.innerHTML = '<div style="color:#e67e22">‚ö†Ô∏è Por favor, escribe una pregunta.</div>';
        vistaDiv.style.display = 'block';
        return;
      }

      vistaDiv.style.display = 'block';
      vistaDiv.innerHTML = '<div style="padding:10px;display:flex;align-items:center;gap:10px;color:#555;">‚úçÔ∏è Escribiendo...</div>';

      try {
        console.log('üîç Pregunta IA Interiores Inline:', pregunta);
        const respuesta = await window.iaInteriores.generarRespuesta(pregunta);
        console.log('‚úÖ Respuesta recibida:', respuesta);
        
        let textoRespuesta = 'ü§î No he encontrado una respuesta. Intenta con otra pregunta.';
        if (respuesta && respuesta.resumen) {
          textoRespuesta = respuesta.resumen;
        }
        
        const htmlLimpio = limpiarMarkdown(textoRespuesta);
        vistaDiv.innerHTML = htmlLimpio;
      } catch (error) {
        console.error('‚ùå Error:', error);
        vistaDiv.innerHTML = '<div style="color:#e74c3c">‚ùå Error procesando la pregunta. Intenta de nuevo.</div>';
      }
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      if (!cargarHistorialChat()) {
        setTimeout(() => {
          agregarMensajeChat('üëã ¬°Hola! Soy la IA de ATRM para el Convenio de Interiores. ¬øQu√© necesitas saber?', 'bot');
        }, 500);
      }
      
      // Listener para Enter en input inline
      const inputInline = document.getElementById('preguntaIAInline');
      if (inputInline) {
        inputInline.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') preguntarIAInline();
        });
      }
    });

    document.getElementById('formVacaciones').addEventListener('submit', (e) => {
      e.preventDefault();
      const jornadaAnual = parseFloat(document.getElementById('jornadaInput').value);
      const diasTrabajados = parseFloat(document.getElementById('diasInput').value);

      // Calcular d√≠as de vacaciones y descansos
      const diasVacaciones = 30;
      const diasDescanso = (jornadaAnual / 40) * 2; // 2 d√≠as de descanso por cada 40 horas
      const totalDiasDescanso = diasVacaciones + diasDescanso;

      // Mostrar resultado
      document.getElementById('resultadoVacaciones').innerHTML = `Tienes derecho a <strong>${totalDiasDescanso.toFixed(1)}</strong> d√≠as de vacaciones y descansos al a√±o.`;
    });
  </script>
  <script src="js/modo_oscuro.js"></script>
  <script src="js/calculadora_vacaciones.js"></script>
  
  <!-- Scripts para nuevas funcionalidades -->
  <link rel="stylesheet" href="css/notificaciones.css">
  <link rel="stylesheet" href="css/telegram_widget.css">
  <script src="js/notificaciones.js"></script>
  <script src="js/telegram_widget.js"></script>
  <script src="js/pwa.js"></script>
<script src="js/professional-ui.js"></script>
</body>
</html>
