<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ATRM - Tu Sindicato</title>
  <style>
    :root{ --primary:#FF6B35; --secondary:#FF8C42; --accent:#FFA726; --dark:#2C3E50; --light:#FFFFFF; }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;color:var(--dark);background:linear-gradient(180deg, #fff 0%, #fff7f0 100%)}
    header{position:sticky;top:0;z-index:10;background:linear-gradient(90deg,var(--primary),var(--secondary));color:#fff}
    .nav{max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:14px 20px}
    .logo{font-weight:800;letter-spacing:.3px}
    .menu a{color:#fff;text-decoration:none;margin:0 10px;padding:8px 12px;border-radius:10px;transition:.2s}
    .menu a:hover{background:rgba(255,255,255,.15)}
    .hero{max-width:1100px;margin:28px auto;padding:24px 20px;display:grid;grid-template-columns:1.1fr .9fr;gap:28px}
    .card{background:#fff;border:1px solid #ffe2cf;border-radius:18px;box-shadow:0 10px 24px rgba(255,119,51,.08)}
    .hero .left{padding:28px}
    .badge{display:inline-block;background:linear-gradient(90deg,var(--secondary),var(--accent));color:#4e2b00;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700}
    h1{margin:10px 0 14px;font-size:36px}
    .cta{display:flex;gap:12px;margin-top:18px}
    .btn{background:linear-gradient(90deg,var(--primary),var(--secondary));border:none;color:#fff;padding:12px 16px;border-radius:12px;cursor:pointer;font-weight:700;text-decoration:none;display:inline-block;transition:.2s}
    .btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(255,107,53,.3)}
    .btn.alt{background:#fff;color:var(--primary);border:2px solid var(--primary)}
    .btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
    .news{padding:18px}
    .news h3{margin:0 0 8px}
    .news .item{border-top:1px solid #f3d7c2;padding:12px 0}
    .grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:18px;padding:0 20px 40px}
    .tile{padding:20px}
    .tile h3{margin-top:0}
    .update-notice{background:linear-gradient(90deg,#fff3e7,#ffe2cf);border-left:4px solid var(--accent);padding:12px;margin:12px 0;border-radius:8px;font-size:14px}
    .ai-notice{background:linear-gradient(90deg,#e8f5e8,#f0fff0);border-left:4px solid #4CAF50;padding:12px;margin:12px 0;border-radius:8px;font-size:14px}
    .loading{display:none;align-items:center;gap:8px;margin-top:10px}
    .spinner{width:20px;height:20px;border:2px solid var(--accent);border-radius:50%;border-top-color:transparent;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    @media(max-width:900px){.hero{grid-template-columns:1fr}.grid{grid-template-columns:1fr}}
    /* Mejora de visibilidad para respuestas */
    .answer{font-size:18px; line-height:1.6; background:#fff3e6; border-left:6px solid var(--primary); padding:16px; border-radius:12px;}
    .answer strong{font-size:19px}
    /* Bot√≥n cerrar siempre visible */
    .modal-header{position:sticky;top:0;z-index:2;background:linear-gradient(90deg,var(--secondary),var(--accent));padding:10px 14px;color:#4e2b00;font-weight:800;display:flex;align-items:center;justify-content:space-between}
    .close-top{background:#fff;color:var(--primary);border:2px solid var(--primary);border-radius:10px;padding:6px 10px;font-weight:800;cursor:pointer}
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="logo">ATRM ¬∑ Tu Sindicato</div>
      <nav class="menu">
        <a href="#inicio">Inicio</a>
        <a href="#convenio">Convenio</a>
        <a href="salaries.html">Salarios</a>
        <a href="tramites.html">Tr√°mites</a>
        <a href="#noticias">Noticias</a>
        <a href="#contacto">Contacto</a>
      </nav>
    </div>
  </header>

  <main id="inicio" class="hero">
    <section class="left card">
      <span class="badge">Limpieza P√∫blica Viaria ¬∑ Regi√≥n de Murcia</span>
      <h1>Defendemos tus derechos con cercan√≠a y resultados</h1>
      <p>ATRM es el sindicato de referencia para los trabajadores de limpieza viaria y servicios municipales en la Regi√≥n de Murcia. Te acompa√±amos en cada paso: asesor√≠a laboral, negociaci√≥n colectiva y acciones para mejorar las condiciones del sector.</p>
      <div class="cta">
        <a class="btn" href="#convenio">Ver Convenio</a>
        <a class="btn alt" href="tramites.html">Tr√°mites</a>
      </div>
    </section>
    <aside class="card news" id="noticias">
      <h3>√öltimas noticias</h3>
      <div class="update-notice">
        üìÖ <strong>Noticias actualizadas semanalmente</strong><br>
        Revisa esta secci√≥n cada semana para estar al d√≠a con las novedades del sector y las acciones del sindicato.
      </div>
      <div id="newsList"></div>
    </aside>
  </main>

  <section id="convenio" class="grid">
    <div class="card tile">
      <h3>Convenio Colectivo 2024‚Äì2027</h3>
      <p id="convenioResumen"></p>
      <ul id="convenioDatos"></ul>
      <button class="btn" onclick="abrirIA()">Preg√∫ntale a la IA sobre el convenio</button>
      <div id="vistaRespuesta" style="display:none;margin-top:12px"></div>
    </div>
    <div class="card tile">
      <h3>√Åmbito de aplicaci√≥n</h3>
      <p id="ambito"></p>
    </div>
    <div class="card tile">
      <h3>Documentaci√≥n</h3>
      <p>Accede a la tabla salarial actualizada y al texto completo del convenio.</p>
      <div class="update-notice">
        üí∞ <strong>Nuevo:</strong> <a href="salaries.html" style="color:var(--primary)">Ver tabla salarial 2025</a> con incrementos aplicados.
      </div>
      <div class="update-notice">
        üèõÔ∏è <strong>Nuevo:</strong> <a href="tramites.html" style="color:var(--primary)">Tr√°mites con administraci√≥n</a> - gu√≠as paso a paso.
      </div>
    </div>
  </section>

  <section id="contacto" class="grid">
    <div class="card tile">
      <h3>Contacto</h3>
      <div id="contactoData"></div>
    </div>
    <div class="card tile">
      <h3>Representantes</h3>
      <div id="reps"></div>
    </div>
    <div class="card tile">
      <h3>Atenci√≥n</h3>
      <p id="horario"></p>
      <div class="update-notice">
        ‚ÑπÔ∏è <strong>Informaci√≥n actualizada:</strong> Los datos de contacto y representantes se actualizan regularmente. Para emergencias laborales, utiliza siempre el tel√©fono principal.
      </div>
    </div>
  </section>

  <dialog id="iaModal" style="max-width:820px;width:96%;border:none;border-radius:16px;padding:0;overflow:auto;max-height:85vh">
    <div class="modal-header">
      <span>ü§ñ Asistente IA del Convenio ATRM</span>
      <button class="close-top" onclick="document.getElementById('iaModal').close()">Cerrar</button>
    </div>
    <div style="padding:16px">
      <div class="ai-notice">
        üéÜ <strong>IA Real integrada</strong><br>
        Este asistente usa inteligencia artificial para entender tus preguntas en lenguaje natural sobre el convenio.
      </div>
      <p style="margin-top:0">Haz tu pregunta sobre el convenio. Ejemplos: "ingreso de madre", "incremento 2025", "vacaciones"‚Ä¶</p>
      <input id="preguntaIA" placeholder="Ej. Mi madre est√° ingresada, ¬øcu√°ntos d√≠as tengo de permiso?" style="width:100%;padding:14px;border:1px solid #ffd2b5;border-radius:12px;font-size:16px" />
      <button id="btnPreguntar" class="btn" style="margin-top:12px" onclick="preguntarIA()">Preguntar a la IA</button>
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <span>La IA est√° procesando tu pregunta...</span>
      </div>
      <div id="respuestaIA" class="answer" style="margin-top:14px;display:none"></div>
    </div>
    <div style="padding:10px 16px;background:#fff3e7;text-align:right;position:sticky;bottom:0;z-index:2">
      <button class="btn alt" onclick="document.getElementById('iaModal').close()">Cerrar</button>
    </div>
  </dialog>

  <script>
    let API_ENDPOINT = '/api/chat'; // Para Vercel/Netlify
    
    async function cargar(){
      try {
        const res = await fetch('data/atrm_sindicato_data.json');
        const data = await res.json();
        
        // Noticias
        const news = [...data.noticias];
        const list = document.getElementById('newsList');
        const lastUpdate = document.createElement('div');
        lastUpdate.style.cssText = 'font-size:12px;color:#666;margin-bottom:8px;text-align:right';
        lastUpdate.textContent = `√öltima actualizaci√≥n: ${new Date().toLocaleDateString('es-ES')}`;
        list.appendChild(lastUpdate);
        news.forEach(n=>{
          const div = document.createElement('div');
          div.className = 'item';
          div.innerHTML = `<strong>${n.fecha}</strong><br>${n.titulo}<br><small style=\"color:#888\">${n.fuente}</small>`;
          list.appendChild(div);
        });
        
        // Convenio
        document.getElementById('convenioResumen').textContent = `${data.convenio.nombre} (c√≥digo ${data.convenio.codigo}). Vigencia: ${data.convenio.vigencia}.`;
        const ul = document.getElementById('convenioDatos');
        const li1 = document.createElement('li'); 
        li1.textContent = `Jornada: ${data.convenio.jornada}`; 
        ul.appendChild(li1);
        Object.entries(data.convenio.incrementos_salariales).forEach(([k,v])=>{
          const li = document.createElement('li');
          li.textContent = `Incremento ${k}: ${v}`;
          ul.appendChild(li);
        });
        document.getElementById('ambito').textContent = data.convenio.ambito_aplicacion;
        
        // Contacto
        const c = data.contactos;
        document.getElementById('contactoData').innerHTML = `
          <p>Tel√©fono principal: <strong>${c.telefono_principal}</strong><br>
          Informaci√≥n: <strong>${c.telefono_informacion}</strong><br>
          Email: <strong>${c.email_general}</strong><br>
          Direcci√≥n: ${c.direccion}</p>`;
        document.getElementById('horario').textContent = c.horario_atencion;
        const reps = document.getElementById('reps');
        c.representantes.forEach(r=>{
          const p = document.createElement('p');
          p.innerHTML = `<strong>${r.cargo}</strong><br>${r.nombre}<br>${r.telefono}<br><a href=\"mailto:${r.email}\" style=\"color:var(--primary)\">${r.email}</a>`;
          reps.appendChild(p);
        });
        
      } catch(error) {
        console.error('Error cargando datos:', error);
        document.getElementById('newsList').innerHTML = '<p style="color:#999">Error cargando las noticias. Por favor, recarga la p√°gina.</p>';
      }
    }
    
    function abrirIA(){ 
      document.getElementById('iaModal').showModal(); 
      document.getElementById('preguntaIA').focus();
    }
    
    async function preguntarIA() {
      const pregunta = document.getElementById('preguntaIA').value.trim();
      if (!pregunta) {
        alert('Por favor, escribe tu pregunta');
        return;
      }
      
      const btn = document.getElementById('btnPreguntar');
      const loading = document.getElementById('loading');
      const respuestaDiv = document.getElementById('respuestaIA');
      const vistaRespuesta = document.getElementById('vistaRespuesta');
      
      btn.disabled = true;
      loading.style.display = 'flex';
      respuestaDiv.style.display = 'none';
      if (vistaRespuesta) vistaRespuesta.style.display = 'none';
      
      try {
        const respuesta = generarRespuestaLocal(pregunta);
        
        respuestaDiv.innerHTML = respuesta;
        respuestaDiv.style.display = 'block';
        
        if (vistaRespuesta) {
          vistaRespuesta.innerHTML = `<div class=\"answer\"><strong>√öltima respuesta:</strong><br>${respuesta}</div>`;
          vistaRespuesta.style.display = 'block';
        }
        
      } catch (error) {
        console.error('Error:', error);
        respuestaDiv.innerHTML = '<div style="color:#e74c3c">‚ùå Error procesando la pregunta. Intenta de nuevo o contacta ATRM: 968 626 511</div>';
        respuestaDiv.style.display = 'block';
      } finally {
        btn.disabled = false;
        loading.style.display = 'none';
      }
    }
    
    function generarRespuestaLocal(pregunta) {
      const p = pregunta.toLowerCase();
      if ((p.includes('ingreso') && p.includes('madre')) || 
          (p.includes('ingreso') && p.includes('padre')) ||
          (p.includes('ingreso') && p.includes('familiar')) ||
          (p.includes('madre') && p.includes('ingresada')) ||
          (p.includes('padre') && p.includes('ingresado')) ||
          (p.includes('madre') && p.includes('hospital')) ||
          (p.includes('hospital') && p.includes('familiar')) ||
          p.includes('hospitalizaci√≥n') ||
          p.includes('hospitalizacion') ||
          (p.includes('operaci√≥n') && (p.includes('hermano') || p.includes('familiar'))) ||
          (p.includes('intervenci√≥n') && (p.includes('hermano') || p.includes('familiar'))) ||
          (p.includes('cirug√≠a') && (p.includes('hermano') || p.includes('familiar')))) {
        return 'üè• <strong>Permiso por hospitalizaci√≥n/intervenci√≥n familiar:</strong><br><br>‚úÖ Tienes derecho a <strong>5 d√≠as retribuidos</strong> por:<br>- Ingreso hospitalario de familiares hasta 2¬∫ grado<br>- Accidente o enfermedad grave<br>- Intervenci√≥n quir√∫rgica<br><br>üë• <strong>Familiares incluidos:</strong> madre, padre, hijos, hermanos, abuelos, suegros, c√≥nyuge<br><br>‚ú® <strong>Ampliaci√≥n:</strong> Si la hospitalizaci√≥n supera 15 d√≠as, el permiso se puede ampliar<br><br>üìû <strong>Gestionar permiso:</strong> Contacta ATRM 968 626 511';
      }
      if (p.includes('lluvia') || p.includes('llueve') || p.includes('tormenta') || p.includes('impermeable')) {
        return 'üåßÔ∏è <strong>D√≠as de lluvia intensa:</strong><br><br>**Si la empresa facilit√≥ impermeable y botas:**<br>- La decisi√≥n de parar se toma conjuntamente entre empresa y representantes<br>- Si no hay representantes, con los propios trabajadores<br><br>**Si la empresa NO facilit√≥ prendas:**<br>- La decisi√≥n la toman los representantes de los trabajadores<br>- Si no los hay, los propios trabajadores<br><br>**Si se para por lluvia:**<br>- Las personas trabajadoras permanecen en el centro durante la jornada<br><br>üìû <strong>Contacto:</strong> ATRM 968 626 511';
      }
      if (p.includes('jornada') || p.includes('hora')) {
        return '‚è∞ <strong>Jornada laboral:</strong><br>37 horas y 30 minutos semanales (1.680 horas anuales).<br>Descanso: 20 minutos bocadillo (computable) + 10 minutos adicionales opcionales.<br>Turno general de ma√±ana.';
      }
      if (p.includes('increment') || p.includes('salari') || p.includes('sueld') || p.includes('cobra')) {
        return 'üí∞ <strong>Incrementos salariales:</strong><br>2024: 400‚Ç¨ lineales para todas las categor√≠as<br>2025: IPC real nacional de 2024<br>2026: IPC real nacional de 2025<br>2027: IPC real nacional de 2026';
      }
      if (p.includes('paga') || p.includes('extra') || p.includes('productiv')) {
        return 'üéÅ <strong>Pagas extras:</strong><br>Junio y Diciembre: salario base + antig√ºedad + plus<br>Productividad: 30 d√≠as (marzo)<br>Septiembre: 30 d√≠as (septiembre)<br>Bolsa enero: seg√∫n tabla + 400‚Ç¨ incremento 2024';
      }
      if (p.includes('vacacion')) {
        return 'üèñÔ∏è <strong>Vacaciones:</strong><br>28 d√≠as laborales + d√≠as asuntos propios<br>Festividad patronal: San Mart√≠n de Porres (3 noviembre)<br>Desde 2026: d√≠as compensatorios por festivos coincidentes con descanso';
      }
      if (p.includes('plus') || p.includes('toxico') || p.includes('nocturno')) {
        return '‚ú® <strong>Pluses especiales:</strong><br>Toxicidad: 30% sobre salario base (conductores, peones, talleres)<br>Asistencia: 30% sobre salario base (resto de personal)<br>Nocturnidad: 28% sobre salario base (22:00-06:00h) desde enero 2025';
      }
      if (p.includes('baja') || p.includes('enferm')) {
        return 'üè• <strong>Prestaciones por baja:</strong><br>Baja laboral: complemento hasta 100% del salario real los primeros 60 d√≠as<br>Accidente de trabajo: 100% del salario real desde el primer d√≠a';
      }
      return 'ü§ñ <strong>No encuentro informaci√≥n espec√≠fica.</strong><br><br>üìÅ <strong>Ejemplos de preguntas:</strong><br>‚Ä¢ "operaci√≥n de hermano" o "mi hermano est√° ingresado"<br>‚Ä¢ "d√≠as de lluvia" o "llueve mucho"<br>‚Ä¢ "jornada laboral" o "cu√°ntas horas trabajo"<br>‚Ä¢ "incremento salarial 2025"<br>‚Ä¢ "pagas extra" o "cu√°ndo cobro"<br>‚Ä¢ "vacaciones"<br><br>üìû <strong>Consultas personalizadas:</strong> ATRM 968 626 511';
    }
    
    document.addEventListener('DOMContentLoaded', function(){
      cargar();
      const input = document.getElementById('preguntaIA');
      if (input) {
        input.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') preguntarIA();
        });
      }
    });
  </script>
</body>
</html>