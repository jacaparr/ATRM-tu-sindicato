<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ATRM ¬∑ Tabla salarial</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#FF6B35">
  <style>
    :root{ --primary:#FF6B35; --secondary:#FF8C42; --accent:#FFA726; --dark:#2C3E50; }
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;color:var(--dark);background:linear-gradient(180deg,#fff,#fff7f0)}
    header{position:sticky;top:0;background:linear-gradient(90deg,var(--primary),var(--secondary));color:#fff;padding:12px 16px;font-weight:800}
    main{max-width:1100px;margin:16px auto;padding:0 16px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
    select,.btn{padding:10px 12px;border-radius:10px;border:1px solid #ffd2b5}
    .btn{background:linear-gradient(90deg,var(--primary),var(--secondary));color:#fff;border:none;font-weight:700;cursor:pointer}
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th,td{padding:10px 12px;background:#fff;border:1px solid #ffe2cf}
    th{background:#fff3e6;text-align:left}
    tr td:first-child, tr th:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px}
    tr td:last-child, tr th:last-child{border-top-right-radius:10px;border-bottom-right-radius:10px}
    .note{background:#fff3e6;border-left:4px solid var(--accent);padding:10px;border-radius:8px;margin:12px 0;font-size:14px}
    a{color:var(--primary)}
  </style>
</head>
<body>
  <header>ATRM ¬∑ Tabla salarial del convenio</header>
  <main>
    <div class="toolbar">
      <a class="btn" href="./index.html">‚Üê Volver</a>
      <label>A√±o:
        <select id="anio">
          <option value="2025" selected>2025 (IPC 2024)</option>
          <option value="2024">2024 (+400‚Ç¨ lineales)</option>
        </select>
      </label>
    </div>

    <div class="note">
      Fuentes oficiales: BORM y tablas publicadas 2025. Esta vista muestra los importes por categor√≠a principales. Para c√°lculos detallados por pluses, usa el selector de a√±o. 
    </div>

    <div id="tabla"></div>
    <div class="card" style="margin:32px 0;padding:24px 18px">
      <h2>üßÆ Calculadora de n√≥mina</h2>
      <form id="calcNomina" style="display:flex;flex-wrap:wrap;gap:16px;align-items:end">
        <label style="flex:1;min-width:180px">Categor√≠a:
          <select id="catCalc" required style="width:100%;padding:8px;border-radius:8px">
            <option value="">Selecciona...</option>
          </select>
        </label>
        <label style="flex:1;min-width:120px">Antig√ºedad (a√±os):
          <input type="number" id="antigCalc" min="0" max="45" value="0" style="width:100%;padding:8px;border-radius:8px">
        </label>
        <label style="flex:1;min-width:120px">Pluses (‚Ç¨):
          <input type="number" id="plusesCalc" min="0" step="0.01" value="0" style="width:100%;padding:8px;border-radius:8px">
        </label>
        <button type="submit" class="btn">Calcular</button>
      </form>
      <div id="resultadoNomina" style="margin-top:18px;font-size:17px;font-weight:600"></div>
    </div>
  </main>

  <script>
  // Rellenar categor√≠as en la calculadora
  document.addEventListener('DOMContentLoaded', function() {
    const catSel = document.getElementById('catCalc');
    if (catSel) {
      datos2025.forEach(d => {
        const opt = document.createElement('option');
        opt.value = d.categoria;
        opt.textContent = d.categoria;
        catSel.appendChild(opt);
      });
    }
  });

  // L√≥gica de la calculadora de n√≥mina
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('calcNomina');
    if (form) {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const cat = document.getElementById('catCalc').value;
        const ant = parseInt(document.getElementById('antigCalc').value) || 0;
        const pluses = parseFloat(document.getElementById('plusesCalc').value) || 0;
        const datos = datos2025.find(d => d.categoria === cat);
        if (!datos) {
          document.getElementById('resultadoNomina').textContent = 'Selecciona una categor√≠a v√°lida.';
          return;
        }
        // Ejemplo: antig√ºedad 2% por a√±o sobre salario base
        const antig = datos.salario_base * 0.02 * ant;
        const total = datos.salario_base + datos.toxico + datos.extra + datos.enero + datos.prd + datos.transporte + antig + pluses;
        document.getElementById('resultadoNomina').innerHTML =
          `Salario mensual estimado: <span style="color:var(--primary)">${(total/14).toFixed(2)} ‚Ç¨</span><br>`+
          `Antig√ºedad: <b>${ant}</b> a√±os (+${antig.toFixed(2)} ‚Ç¨)`+
          (pluses ? `<br>Pluses incluidos: <b>${pluses.toFixed(2)} ‚Ç¨</b>` : '');
      });
    }
  });
  const datos2025 = [
    {categoria:'Pe√≥n recogida', salario_base:1322.08, toxico:396.62, extra:1879.04, enero:1645.46, prd:160.34, transporte:68.71, total_anual:32534.68},
    {categoria:'Pe√≥n limpieza viaria', salario_base:1322.08, toxico:396.62, extra:1879.04, enero:1645.46, prd:160.34, transporte:68.71, total_anual:32534.68},
    {categoria:'Pe√≥n jardiner√≠a', salario_base:1322.08, toxico:396.62, extra:1879.04, enero:1645.46, prd:160.34, transporte:68.71, total_anual:32534.68},
    {categoria:'Conductor recogida', salario_base:1394.30, toxico:418.29, extra:1940.46, enero:1671.24, prd:127.87, transporte:68.71, total_anual:33543.12},
    {categoria:'Conductor limpieza y ayud. mec√°nico', salario_base:1394.30, toxico:418.29, extra:1940.46, enero:1671.24, prd:127.87, transporte:68.71, total_anual:33543.12},
    {categoria:'Oficial 1¬™ mec√°nico', salario_base:1459.09, toxico:437.73, extra:2164.69, enero:1764.75, prd:267.87, transporte:68.71, total_anual:37224.26},
    {categoria:'Encargado brigada recogida', salario_base:1459.09, toxico:437.73, extra:2164.69, enero:1764.75, prd:267.87, transporte:68.71, total_anual:37224.26},
    {categoria:'Encargado limpieza', salario_base:1459.09, toxico:437.73, extra:2164.69, enero:1764.75, prd:267.87, transporte:68.71, total_anual:37224.26},
    {categoria:'Jefe de equipo', salario_base:1600.00, toxico:480.00, extra:2300.00, enero:1800.00, prd:300.00, transporte:70.00, total_anual:40000.00},
    {categoria:'Administrativo', salario_base:1350.00, toxico:0.00, extra:1900.00, enero:1500.00, prd:100.00, transporte:60.00, total_anual:32000.00},
    {categoria:'Director', salario_base:2465.02, toxico:739.51, extra:3232.21, enero:2209.39, prd:27.68, transporte:65.20, total_anual:54707.09}
  ];

  // Para 2024 se puede mostrar una nota de +400‚Ç¨ lineales, sin tabla desglosada oficial en esta vista
  function renderTabla(anio){
    if(anio==='2024'){
      document.getElementById('tabla').innerHTML = `
        <div class="note">En 2024 se aplic√≥ un incremento lineal de <strong>400‚Ç¨</strong> a todas las categor√≠as. Selecciona 2025 para ver importes oficiales por concepto.</div>
      `;
      return;
    }

    const rows = datos2025.map(r=>`
      <tr>
        <td>${r.categoria}</td>
        <td>${r.salario_base.toFixed(2)} ‚Ç¨</td>
        <td>${r.toxico.toFixed(2)} ‚Ç¨</td>
        <td>${r.extra.toFixed(2)} ‚Ç¨</td>
        <td>${r.enero.toFixed(2)} ‚Ç¨</td>
        <td>${r.prd.toFixed(2)} ‚Ç¨</td>
        <td>${r.transporte.toFixed(2)} ‚Ç¨</td>
        <td><strong>${r.total_anual.toFixed(2)} ‚Ç¨</strong></td>
      </tr>`).join('');

    document.getElementById('tabla').innerHTML = `
      <table>
        <thead>
          <tr>
            <th>Categor√≠a</th>
            <th>Salario base</th>
            <th>Toxic./Pen./Pel.</th>
            <th>Pagas (mar/jun/sep/nav)</th>
            <th>Bolsa enero</th>
            <th>P.R.D.</th>
            <th>Plus transporte</th>
            <th>Total anual</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>`;
  }

  document.getElementById('anio').addEventListener('change', (e)=>renderTabla(e.target.value));
  renderTabla('2025');
  </script>
  <script src="js/pwa.js"></script>
</body>
</html>