<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Convenio Interiores Â· ATRM - Tu Sindicato</title>
  <style>
    :root{ --primary:#FF6B35; --secondary:#FF8C42; --accent:#FFA726; --dark:#2C3E50; --light:#FFFFFF; }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;color:var(--dark);background:linear-gradient(180deg, #fff 0%, #fff7f0 100%)}
    header{position:sticky;top:0;z-index:10;background:linear-gradient(90deg,var(--primary),var(--secondary));color:#fff}
    .nav{max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:14px 20px}
    .logo{font-weight:800;letter-spacing:.3px}
    .menu a{color:#fff;text-decoration:none;margin:0 10px;padding:8px 12px;border-radius:10px;transition:.2s}
    .menu a:hover{background:rgba(255,255,255,.15)}
    .menu a.active{background:rgba(255,255,255,.25)}

    .hero{max-width:1100px;margin:28px auto;padding:24px 20px;display:grid;grid-template-columns:1.1fr .9fr;gap:28px}
    .card{background:#fff;border:1px solid #ffe2cf;border-radius:18px;box-shadow:0 10px 24px rgba(255,119,51,.08)}
    .hero .left{padding:28px}
    .badge{display:inline-block;background:linear-gradient(90deg,var(--secondary),var(--accent));color:#4e2b00;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700}
    h1{margin:10px 0 14px;font-size:36px}
    .cta{display:flex;gap:12px;margin-top:18px;flex-wrap:wrap}
    .btn{background:linear-gradient(90deg,var(--primary),var(--secondary));border:none;color:#fff;padding:12px 16px;border-radius:12px;cursor:pointer;font-weight:700;text-decoration:none;display:inline-block;transition:.2s}
    .btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(255,107,53,.3)}
    .btn.alt{background:#fff;color:var(--primary);border:2px solid var(--primary)}
    .news{padding:18px}
    .grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:18px;padding:0 20px 40px}

    /* Chat flotante */
    #chat-atm-btn{position:fixed;bottom:20px;right:20px;width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,#27ae60,#2ecc71);color:#fff;border:none;font-size:28px;cursor:pointer;box-shadow:0 4px 12px rgba(39,174,96,.4);z-index:1000}
    #chat-atm-btn:hover{transform:scale(1.05)}
    #chat-atm-window{display:none;position:fixed;bottom:90px;right:20px;width:360px;max-width:90vw;height:500px;max-height:70vh;background:#fff;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.15);flex-direction:column;z-index:1001}
    #chat-header{background:linear-gradient(90deg,#27ae60,#2ecc71);color:#fff;padding:14px;border-radius:16px 16px 0 0;display:flex;justify-content:space-between;align-items:center}
    #chat-close{background:none;border:none;color:#fff;font-size:24px;cursor:pointer}
    #chat-messages{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:10px}
    #chat-form{display:flex;padding:10px;border-top:1px solid #eee}
    #chat-input{flex:1;padding:10px;border:1px solid #ddd;border-radius:20px;margin-right:8px}
    #chat-send{background:#27ae60;color:#fff;border:none;padding:10px 16px;border-radius:20px;cursor:pointer}

    @media(max-width:900px){.hero{grid-template-columns:1fr}.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="logo">ATRM Â· Tu Sindicato</div>
      <nav class="menu">
        <a href="index.html">Inicio</a>
        <a href="index.html#convenio">Viaria</a>
        <a href="interiores.html" class="active">Interiores</a>
        <a href="salaries.html">Salarios</a>
        <a href="tramites.html">TrÃ¡mites</a>
        <a href="festivos.html">Festivos</a>
        <a href="noticias.html">Noticias</a>
        <a href="index.html#contacto">Contacto</a>
      </nav>
    </div>
  </header>

  <main class="hero">
    <section class="left card">
      <span class="badge">Limpieza de Edificios y Locales Â· RegiÃ³n de Murcia</span>
      <h1>Convenio Colectivo de Limpieza de Interiores</h1>
      <p>Consulta aquÃ­ el convenio de limpieza de edificios y locales, descarga el PDF oficial y pregunta a la IA sobre tus derechos y condiciones laborales.</p>
      <div class="cta">
        <a class="btn" href="assets/convenio_interiores.pdf" download>ðŸ“„ Descargar Convenio PDF</a>
        <button class="btn alt" onclick="abrirChatInteriores()">ðŸ’¬ Pregunta a la IA</button>
      </div>
    </section>
    <aside class="card news">
      <h3>Datos clave del convenio</h3>
      <ul style="line-height:1.8">
        <li><strong>Jornada mÃ¡xima:</strong> 1.792 horas/aÃ±o</li>
        <li><strong>Vacaciones:</strong> 30 dÃ­as naturales</li>
        <li><strong>Pagas extra:</strong> 3 al aÃ±o (jun, dic, mar)</li>
        <li><strong>Descanso semanal:</strong> 1,5 dÃ­as</li>
        <li><strong>Vigencia:</strong> BORM 20/09/2024</li>
      </ul>
    </aside>
  </main>

  <section class="grid">
    <div class="card" style="padding:20px">
      <h3>ðŸ“‹ Permisos retribuidos</h3>
      <p><strong>Matrimonio:</strong> 15 dÃ­as<br>
      <strong>Nacimiento:</strong> 2 dÃ­as<br>
      <strong>Fallecimiento:</strong> 2-4 dÃ­as<br>
      <strong>Mudanza:</strong> 1 dÃ­a<br>
      <strong>ExÃ¡menes:</strong> tiempo necesario</p>
    </div>
    <div class="card" style="padding:20px">
      <h3>ðŸ’° Salario y complementos</h3>
      <p>Salario base segÃºn categorÃ­a + trienios al 5%. Complemento de IT hasta 100% desde primer dÃ­a en accidente laboral.</p>
    </div>
    <div class="card" style="padding:20px">
      <h3>ðŸ”„ SubrogaciÃ³n</h3>
      <p>En caso de cambio de empresa, se mantiene antigÃ¼edad, salario y condiciones. La nueva empresa debe respetar el convenio.</p>
    </div>
  </section>

  <!-- Chat flotante IA Interiores -->
  <button id="chat-atm-btn" onclick="abrirChatInteriores()" aria-label="Abrir chat IA Interiores">ðŸ’¬</button>
  <div id="chat-atm-window">
    <div id="chat-header">
      <strong>ATRM Chat Â· Interiores</strong>
      <select id="modoIAChat" style="padding:4px 8px;border-radius:8px;border:none;font-size:13px">
        <option value="breve">Breve</option>
        <option value="completo">Completo</option>
        <option value="estricto">Estricto</option>
      </select>
      <button id="chat-close" onclick="cerrarChatInteriores()">Ã—</button>
    </div>
    <div id="chat-messages"></div>
    <form id="chat-form">
      <input id="chat-input" type="text" placeholder="Escribe tu pregunta..." autocomplete="off" />
      <button id="chat-send" type="submit">âž¤</button>
    </form>
  </div>

  <script src="js/ia_mejorada.js"></script>
  <script src="js/ia_interiores.js"></script>
  <script>
    // Convertir Markdown simple a HTML
    function limpiarMarkdown(texto) {
      if (!texto) return '';
      return texto
        .replace(/~~(.*?)~~/g, '<s>$1</s>')
        .replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>')
        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.+?)\*/g, '<em>$1</em>')
        .replace(/^### (.+)$/gm, '<h3>$1</h3>')
        .replace(/^## (.+)$/gm, '<h2>$1</h2>')
        .replace(/^# (.+)$/gm, '<h1>$1</h1>')
        .replace(/\n/g, '<br>');
    }

    function abrirChatInteriores(){
      document.getElementById('chat-atm-window').style.display = 'flex';
      setTimeout(()=>{
        const el = document.getElementById('chat-input');
        if(el) el.focus();
      }, 200);
      const sel = document.getElementById('modoIAChat');
      if (sel && window.iaInteriores){
        if (window.iaInteriores.modoEstrict) sel.value='estricto';
        else if (window.iaInteriores.modoBreve) sel.value='breve';
        else sel.value='completo';
      }
    }
    function cerrarChatInteriores(){
      document.getElementById('chat-atm-window').style.display = 'none';
    }

    function agregarMensajeChat(mensaje, remitente, guardar = true) {
      const chatMessages = document.getElementById('chat-messages');
      const msgDiv = document.createElement('div');
      msgDiv.style.maxWidth = '85%';
      msgDiv.style.alignSelf = remitente==='user'?'flex-end':'flex-start';
      msgDiv.style.background = remitente==='user'?'#e1ffc7':'#fff';
      msgDiv.style.color = '#222';
      msgDiv.style.padding = '8px 12px';
      msgDiv.style.borderRadius = remitente==='user'?'16px 16px 4px 16px':'16px 16px 16px 4px';
      msgDiv.style.boxShadow = '0 2px 8px rgba(0,0,0,0.04)';
      msgDiv.style.wordBreak = 'break-word';

      if (remitente === 'bot') {
        msgDiv.style.alignSelf = 'flex-start';
        msgDiv.innerHTML = limpiarMarkdown(mensaje);
      } else {
        msgDiv.style.alignSelf = 'flex-end';
        msgDiv.textContent = mensaje;
      }
      
      // AÃ±adir botones de feedback solo para mensajes del bot
      if (remitente === 'bot' && !mensaje.includes('âœï¸ Escribiendo')) {
        const feedbackDiv = document.createElement('div');
        feedbackDiv.style.marginTop = '6px';
        feedbackDiv.style.display = 'flex';
        feedbackDiv.style.gap = '8px';
        feedbackDiv.style.fontSize = '18px';
        
        const btnLike = document.createElement('button');
        btnLike.innerHTML = 'ðŸ‘';
        btnLike.style.border = 'none';
        btnLike.style.background = 'transparent';
        btnLike.style.cursor = 'pointer';
        btnLike.style.fontSize = '18px';
        btnLike.style.padding = '4px 8px';
        btnLike.style.opacity = '0.6';
        btnLike.onclick = () => registrarFeedback('like', feedbackDiv);
        
        const btnDislike = document.createElement('button');
        btnDislike.innerHTML = 'ðŸ‘Ž';
        btnDislike.style.border = 'none';
        btnDislike.style.background = 'transparent';
        btnDislike.style.cursor = 'pointer';
        btnDislike.style.fontSize = '18px';
        btnDislike.style.padding = '4px 8px';
        btnDislike.style.opacity = '0.6';
        btnDislike.onclick = () => registrarFeedback('dislike', feedbackDiv);
        
        feedbackDiv.appendChild(btnLike);
        feedbackDiv.appendChild(btnDislike);
        msgDiv.appendChild(feedbackDiv);
      }
      
      chatMessages.appendChild(msgDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      if (guardar) {
        guardarHistorialChat();
      }
      return msgDiv;
    }
    
    function registrarFeedback(tipo, feedbackDiv) {
      feedbackDiv.innerHTML = '<span style="font-size:13px;color:#666;">âœ“ Gracias por tu feedback</span>';
    }

    async function enviarPreguntaChat(pregunta) {
      if (!pregunta.trim()) return;

      agregarMensajeChat(pregunta, 'user');
      const thinkingMsg = agregarMensajeChat('âœï¸ Escribiendo...', 'bot', false);
      thinkingMsg.id = 'escribiendo-msg';

      try {
        const respuesta = await window.iaInteriores.generarRespuesta(pregunta);
        let textoRespuesta = 'ðŸ¤” No he encontrado una respuesta. Por favor, intenta con otra pregunta.';
        if (respuesta) {
          if (window.iaInteriores.modoRespuesta === 'breve') {
            textoRespuesta = respuesta.resumen || respuesta.detalle;
          } else {
            textoRespuesta = respuesta.detalle;
          }
        }
        thinkingMsg.innerHTML = limpiarMarkdown(textoRespuesta);
        thinkingMsg.id = '';
        guardarHistorialChat();
      } catch (e) {
        thinkingMsg.innerHTML = 'âŒ Error al obtener respuesta.';
        thinkingMsg.id = '';
        guardarHistorialChat();
      }
    }

    function guardarHistorialChat() {
      const chatMessages = document.getElementById('chat-messages');
      const historial = [];
      chatMessages.childNodes.forEach(msgDiv => {
        if (msgDiv.id === 'escribiendo-msg') return;
        historial.push({
          remitente: msgDiv.style.alignSelf === 'flex-end' ? 'user' : 'bot',
          mensaje: msgDiv.style.alignSelf === 'flex-end' ? msgDiv.textContent : msgDiv.innerHTML
        });
      });
      localStorage.setItem('historialChatInteriores', JSON.stringify(historial));
    }

    function cargarHistorialChat() {
      const historial = JSON.parse(localStorage.getItem('historialChatInteriores'));
      if (historial && historial.length) {
        historial.forEach(item => {
          agregarMensajeChat(item.mensaje, item.remitente, false);
        });
        return true;
      }
      return false;
    }

    document.getElementById('chat-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const input = document.getElementById('chat-input');
      const msg = input.value.trim();
      if(!msg) return;
      agregarMensajeChat(msg, 'user');
      input.value = '';
      agregarMensajeChat('...', 'bot');
      if (!window.iaInteriores) {
        enviarPreguntaChat(msg);
      } else {
        setTimeout(() => {
          const respuesta = window.iaInteriores.procesarMultiConsulta(msg);
          agregarMensajeChat(respuesta, 'bot');
        }, 500);
      }
    });
    
    document.getElementById('modoIAChat').addEventListener('change', (e)=>{
      if(window.iaInteriores) window.iaInteriores.setModoRespuesta(e.target.value);
    });

    document.addEventListener('DOMContentLoaded', ()=>{
      if (!cargarHistorialChat()) {
        setTimeout(() => {
          agregarMensajeChat('ðŸ‘‹ Â¡Hola! Soy la IA de ATRM para el Convenio de Interiores. Â¿QuÃ© necesitas saber?', 'bot');
        }, 500);
      }
    });
  </script>
  <script src="js/modo_oscuro.js"></script>
</body>
</html>
